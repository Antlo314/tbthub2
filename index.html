<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Sacred Sanctum | Truth Be Told Hub</title>
    <!-- Production CDN links -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --void: #0a0a0a;
            --obsidian: #141414;
            --charcoal: #1f1f1f;
            --ember: #ff6b35;
            --ember-glow: #ff8c42;
            --flame: #f7931e;
            --gold: #ffb347;
            --ash: #6b6b6b;
            --mist: #a0a0a0;
            --sacred: #ffffff;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--void);
            color: var(--sacred);
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 107, 53, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(247, 147, 30, 0.03) 0%, transparent 50%),
                linear-gradient(to bottom, rgba(10,10,10,0.9), rgba(10,10,10,0.9)),
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
        }

        .font-ritual { font-family: 'Cinzel', serif; }
        .font-script { font-family: 'Playfair Display', serif; }

        .glass-panel {
            background: rgba(31, 31, 31, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .glass-card {
            background: linear-gradient(145deg, rgba(31, 31, 31, 0.8) 0%, rgba(20, 20, 20, 0.9) 100%);
            border: 1px solid rgba(255, 107, 53, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            border-color: rgba(255, 107, 53, 0.3);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(255, 107, 53, 0.1);
        }

        .ember-gradient {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 50%, #ffb347 100%);
        }

        .ember-text {
            background: linear-gradient(135deg, #ff6b35 0%, #ffb347 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .ember-glow {
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.3);
        }

        .ember-border {
            border: 1px solid rgba(255, 107, 53, 0.4);
        }

        .btn-sacred {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-sacred:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.4);
        }

        .btn-sacred::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 60%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .btn-sacred:hover::before {
            opacity: 1;
        }

        .btn-void {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .btn-void:hover {
            border-color: #ff6b35;
            background: rgba(255, 107, 53, 0.1);
        }

        .flame-pulse {
            animation: flamePulse 3s infinite ease-in-out;
        }

        @keyframes flamePulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .floating-ember {
            position: fixed;
            width: 3px;
            height: 3px;
            background: #ff6b35;
            border-radius: 50%;
            opacity: 0.6;
            animation: floatEmber 15s infinite ease-in-out;
            box-shadow: 0 0 8px #ff6b35;
            pointer-events: none;
        }

        @keyframes floatEmber {
            0%, 100% { transform: translateY(100vh) translateX(0); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.6; }
            50% { transform: translateY(-10vh) translateX(50px); }
        }

        .tab-active {
            color: #ff6b35;
            border-bottom: 2px solid #ff6b35;
        }

        .progress-fill {
            background: linear-gradient(90deg, #ff6b35 0%, #f7931e 50%, #ffb347 100%);
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
        }

        .vote-option {
            background: linear-gradient(145deg, rgba(31, 31, 31, 0.6) 0%, rgba(20, 20, 20, 0.8) 100%);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .vote-option:hover {
            border-color: rgba(255, 107, 53, 0.3);
            background: linear-gradient(145deg, rgba(31, 31, 31, 0.8) 0%, rgba(25, 25, 25, 0.9) 100%);
        }

        .vote-option.selected {
            border-color: #ff6b35;
            background: linear-gradient(145deg, rgba(255, 107, 53, 0.1) 0%, rgba(20, 20, 20, 0.9) 100%);
        }

        .input-dark {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }

        .input-dark:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .avatar-circle {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
        }

        .suggestion-card {
            background: rgba(31, 31, 31, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-left: 3px solid #ff6b35;
        }

        .like-btn {
            transition: all 0.2s ease;
        }

        .like-btn:hover {
            color: #ff6b35;
            transform: scale(1.1);
        }

        .like-btn.liked {
            color: #ff6b35;
        }

        .reply-box {
            background: rgba(20, 20, 20, 0.6);
            border-left: 2px solid rgba(255, 107, 53, 0.3);
        }

        .admin-panel {
            background: linear-gradient(145deg, rgba(31, 31, 31, 0.9) 0%, rgba(20, 20, 20, 0.95) 100%);
            border: 1px solid rgba(255, 107, 53, 0.2);
        }

        .danger-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: #ef4444;
            transition: all 0.3s ease;
        }

        .danger-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.2);
        }

        .donation-card {
            background: linear-gradient(145deg, rgba(31, 31, 31, 0.6) 0%, rgba(20, 20, 20, 0.8) 100%);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .donation-card:hover {
            border-color: rgba(255, 107, 53, 0.3);
        }

        .timer-display {
            font-family: 'Cinzel', serif;
            letter-spacing: 0.1em;
            text-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-hidden {
            display: none;
        }

        .section-active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        /* Luxury Additions */
        .magnetic-btn {
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .glow-cursor {
            pointer-events: none;
            position: fixed;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,107,53,0.15) 0%, transparent 70%);
            border-radius: 50%;
            z-index: 0;
            transform: translate(-50%, -50%);
            transition: opacity 0.3s;
        }

        .text-reveal {
            clip-path: polygon(0 0, 100% 0, 100% 100%, 0% 100%);
        }

        .card-lift {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-lift:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(255, 107, 53, 0.25);
        }

        /* Sound toggle */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 40;
        }
    </style>
</head>
<body class="min-h-screen relative overflow-x-hidden">
    <!-- Cursor Glow Effect -->
    <div class="glow-cursor" id="cursor-glow"></div>

    <!-- DEMO MODE TOGGLE - CHANGE TO FALSE TO USE REAL SUPABASE -->
    <script>
        // ‚¨áÔ∏è SET THIS TO FALSE TO ENABLE REAL AUTHENTICATION ‚¨áÔ∏è
        window.ENABLE_DEMO_MODE = false;
        
        // Demo auto-login (only runs if above is true)
        if (window.ENABLE_DEMO_MODE && !localStorage.getItem('demoUser')) {
            localStorage.setItem('demoUser', JSON.stringify({id: '1', email: 'admin@truthbtoldhub.com'}));
            console.log('üé≠ DEMO MODE: Auto-signed in as admin@truthbtoldhub.com');
        }
        
        // Clear demo data if switching from demo to real mode
        if (!window.ENABLE_DEMO_MODE && localStorage.getItem('demoUser')) {
            localStorage.removeItem('demoUser');
            localStorage.removeItem('demoVotes');
            localStorage.removeItem('demoMembers');
            localStorage.removeItem('demoSuggestions');
            console.log('üî• Switched to Real Mode: Demo data cleared');
        }
    </script>

    <!-- Floating Embers -->
    <div id="ember-container"></div>

    <!-- Header -->
    <header class="relative z-20 w-full px-6 py-6 flex items-center justify-between border-b border-white/10 bg-black/20 backdrop-blur-md sticky top-0">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 rounded-full ember-gradient flex items-center justify-center shadow-lg ember-glow flame-pulse">
                <i data-lucide="flame" class="w-6 h-6 text-white"></i>
            </div>
            <div>
                <span class="text-xs font-ritual tracking-[0.3em] text-gray-400 uppercase block">Truth Be Told Hub</span>
                <span class="font-ritual text-xl font-bold text-white tracking-wide">The Sacred Sanctum</span>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <span id="user-status" class="text-sm text-gray-400 hidden md:block">Guest</span>
            <button onclick="toggleAuth()" id="auth-btn" class="btn-sacred text-white px-6 py-2 rounded-full font-medium text-sm">
                Enter Sanctum
            </button>
            <button onclick="signOut()" id="logout-btn" class="hidden btn-void text-gray-300 px-4 py-2 rounded-full text-sm">
                <i data-lucide="log-out" class="w-4 h-4"></i>
            </button>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="relative z-10 w-full border-b border-white/10 bg-black/10 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex overflow-x-auto hide-scrollbar gap-8">
                <button onclick="showTab('home')" id="tab-home" class="tab-active py-4 px-2 font-ritual text-sm tracking-wider whitespace-nowrap flex items-center gap-2 transition-colors">
                    <i data-lucide="home" class="w-4 h-4"></i>
                    <span class="hidden sm:inline">The Hearth</span>
                    <span class="sm:hidden">Home</span>
                </button>
                <button onclick="showTab('members')" id="tab-members" class="py-4 px-2 font-ritual text-sm text-gray-400 hover:text-white tracking-wider whitespace-nowrap flex items-center gap-2 transition-colors">
                    <i data-lucide="users" class="w-4 h-4"></i>
                    <span class="hidden sm:inline">The Order</span>
                    <span class="sm:hidden">Members</span>
                </button>
                <button onclick="showTab('suggestions')" id="tab-suggestions" class="py-4 px-2 font-ritual text-sm text-gray-400 hover:text-white tracking-wider whitespace-nowrap flex items-center gap-2 transition-colors">
                    <i data-lucide="lightbulb" class="w-4 h-4"></i>
                    <span class="hidden sm:inline">The Whispers</span>
                    <span class="sm:hidden">Ideas</span>
                </button>
                <button onclick="showTab('support')" id="tab-support" class="py-4 px-2 font-ritual text-sm text-gray-400 hover:text-white tracking-wider whitespace-nowrap flex items-center gap-2 transition-colors">
                    <i data-lucide="heart-handshake" class="w-4 h-4"></i>
                    <span class="hidden sm:inline">The Offering</span>
                    <span class="sm:hidden">Support</span>
                </button>
                <button onclick="showTab('admin')" id="tab-admin" class="hidden py-4 px-2 font-ritual text-sm text-gray-400 hover:text-white tracking-wider whitespace-nowrap flex items-center gap-2 transition-colors">
                    <i data-lucide="settings" class="w-4 h-4"></i>
                    <span class="hidden sm:inline">The Council</span>
                    <span class="sm:hidden">Admin</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="relative z-10 max-w-7xl mx-auto px-4 py-8">

        <!-- HOME / VOTING SECTION -->
        <section id="section-home" class="section-active">
            <div class="text-center mb-12 hero-content">
                <h1 class="font-ritual text-4xl md:text-6xl font-bold mb-4 ember-text text-reveal" id="hero-title">Cast Thy Flame</h1>
                <p class="font-script italic text-xl text-gray-400 max-w-2xl mx-auto text-reveal" id="hero-subtitle">
                    "The embers speak. The community decides. Choose the next sanctuary to be built."
                </p>
            </div>

            <!-- Timer & Stats Panel -->
            <div class="glass-panel rounded-2xl p-6 md:p-8 mb-10 max-w-4xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                    <div>
                        <p class="text-xs font-ritual tracking-widest text-gray-500 uppercase mb-2">Time Remains</p>
                        <div id="countdown" class="timer-display text-3xl md:text-4xl font-bold text-white">00:00:00</div>
                        <p id="vote-status-text" class="text-xs text-gray-500 mt-2">Cycle Active</p>
                    </div>
                    <div class="md:border-x border-white/10">
                        <p class="text-xs font-ritual tracking-widest text-gray-500 uppercase mb-2">Total Flames</p>
                        <div id="total-flames" class="font-ritual text-3xl md:text-4xl font-bold ember-text">0</div>
                        <p class="text-xs text-gray-500 mt-2">Burning Bright</p>
                    </div>
                    <div>
                        <p class="text-xs font-ritual tracking-widest text-gray-500 uppercase mb-2">Thy Voice</p>
                        <div id="user-vote-status" class="font-ritual text-3xl md:text-4xl font-bold text-gray-300">Silent</div>
                        <p class="text-xs text-gray-500 mt-2">Cast to Ignite</p>
                    </div>
                </div>

                <!-- Admin Controls (Visible only to admin) -->
                <div id="admin-vote-controls" class="hidden mt-8 pt-6 border-t border-white/10">
                    <p class="text-xs font-ritual tracking-widest text-gray-500 uppercase mb-4">Council Controls</p>
                    <div class="flex flex-wrap gap-3">
                        <button onclick="startVote(12)" class="btn-void px-4 py-2 rounded-lg text-sm">Start 12h</button>
                        <button onclick="startVote(24)" class="btn-void px-4 py-2 rounded-lg text-sm">Start 24h</button>
                        <button onclick="startVote(48)" class="btn-void px-4 py-2 rounded-lg text-sm">Start 48h</button>
                        <button onclick="endVote()" class="danger-btn px-4 py-2 rounded-lg text-sm">End Now</button>
                        <button onclick="resetVotes()" class="danger-btn px-4 py-2 rounded-lg text-sm">Reset All</button>
                    </div>
                </div>
            </div>

            <!-- Voting Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12" id="voting-grid">
                <!-- Populated by JS -->
            </div>

            <!-- Vote Table -->
            <div class="glass-panel rounded-2xl p-6 overflow-hidden">
                <h3 class="font-ritual text-xl font-semibold mb-6 flex items-center gap-2">
                    <i data-lucide="scroll-text" class="w-5 h-5 text-orange-500"></i>
                    The Chronicle of Flames
                </h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="border-b border-white/10 text-xs font-ritual tracking-wider text-gray-500 uppercase">
                                <th class="pb-3">Sanctuary</th>
                                <th class="pb-3">Flames</th>
                                <th class="pb-3">Percentage</th>
                                <th class="pb-3">Status</th>
                            </tr>
                        </thead>
                        <tbody id="vote-table-body" class="text-sm">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- MEMBERS SECTION -->
        <section id="section-members" class="section-hidden">
            <div class="text-center mb-12">
                <h1 class="font-ritual text-4xl md:text-5xl font-bold mb-4 text-white">The Order</h1>
                <p class="font-script italic text-xl text-gray-400">Those who bear the mark of community</p>
            </div>

            <div class="glass-panel rounded-2xl p-6 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="font-ritual text-xl font-semibold flex items-center gap-2">
                        <i data-lucide="users" class="w-5 h-5 text-orange-500"></i>
                        <span id="member-count">0</span> Members
                    </h3>
                    <div class="flex gap-2">
                        <select id="member-filter" onchange="filterMembers()" class="input-dark px-4 py-2 rounded-lg text-sm">
                            <option value="all">All Tiers</option>
                            <option value="keeper">Keepers</option>
                            <option value="flame">Flame Bearers</option>
                            <option value="ember">Embers</option>
                        </select>
                    </div>
                </div>

                <div id="members-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Populated by JS -->
                </div>
            </div>
        </section>

        <!-- SUGGESTIONS SECTION -->
        <section id="section-suggestions" class="section-hidden">
            <div class="text-center mb-12">
                <h1 class="font-ritual text-4xl md:text-5xl font-bold mb-4 text-white">The Whispers</h1>
                <p class="font-script italic text-xl text-gray-400">Share thy vision. Shape the sanctuary.</p>
            </div>

            <!-- New Suggestion Form -->
            <div class="glass-panel rounded-2xl p-6 mb-8 max-w-3xl mx-auto">
                <h3 class="font-ritual text-lg font-semibold mb-4 flex items-center gap-2">
                    <i data-lucide="plus-circle" class="w-5 h-5 text-orange-500"></i>
                    Add Thy Voice
                </h3>
                <div class="space-y-4">
                    <textarea id="suggestion-input" rows="3" maxlength="500" 
                        class="input-dark w-full p-4 rounded-xl resize-none" 
                        placeholder="Share thy counsel with the community... (500 characters)"></textarea>
                    <div class="flex justify-between items-center">
                        <span id="char-count" class="text-xs text-gray-500">0 / 500</span>
                        <button onclick="postSuggestion()" class="btn-sacred text-white px-6 py-2 rounded-lg font-medium">
                            Post Whisper
                        </button>
                    </div>
                </div>
            </div>

            <!-- Suggestions List -->
            <div id="suggestions-list" class="space-y-4 max-w-3xl mx-auto">
                <!-- Populated by JS -->
            </div>
        </section>

        <!-- SUPPORT SECTION -->
        <section id="section-support" class="section-hidden">
            <div class="text-center mb-12">
                <h1 class="font-ritual text-4xl md:text-5xl font-bold mb-4 ember-text">The Offering</h1>
                <p class="font-script italic text-xl text-gray-400 max-w-2xl mx-auto">
                    "Fuel the flames. Support the creation. Sustain the truth."
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto mb-12">
                <div class="donation-card rounded-2xl p-8 text-center group hover:border-orange-500/50 transition-all">
                    <div class="w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <span class="text-2xl font-bold text-green-400">$</span>
                    </div>
                    <h3 class="font-ritual text-xl font-semibold mb-2">Cash App</h3>
                    <p class="text-2xl font-bold text-white mb-4">$truufbtold</p>
                    <button onclick="copyToClipboard('$truufbtold')" class="btn-void px-4 py-2 rounded-lg text-sm w-full">
                        Copy Handle
                    </button>
                </div>

                <div class="donation-card rounded-2xl p-8 text-center group hover:border-orange-500/50 transition-all">
                    <div class="w-16 h-16 rounded-full bg-blue-500/20 flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <span class="text-2xl font-bold text-blue-400">V</span>
                    </div>
                    <h3 class="font-ritual text-xl font-semibold mb-2">Venmo</h3>
                    <p class="text-lg font-bold text-white mb-1">@truthbtoldhubdotcome</p>
                    <p class="text-xs text-gray-500 mb-4">Anthony</p>
                    <button onclick="copyToClipboard('@truthbtoldhubdotcome')" class="btn-void px-4 py-2 rounded-lg text-sm w-full">
                        Copy Handle
                    </button>
                </div>

                <div class="donation-card rounded-2xl p-8 text-center group hover:border-orange-500/50 transition-all">
                    <div class="w-16 h-16 rounded-full bg-purple-500/20 flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                        <i data-lucide="wallet" class="w-8 h-8 text-purple-400"></i>
                    </div>
                    <h3 class="font-ritual text-xl font-semibold mb-2">Chime</h3>
                    <p class="text-2xl font-bold text-white mb-4">$truthbtoldhub</p>
                    <button onclick="copyToClipboard('$truthbtoldhub')" class="btn-void px-4 py-2 rounded-lg text-sm w-full">
                        Copy Handle
                    </button>
                </div>

                <div class="donation-card rounded-2xl p-8 text-center opacity-75">
                    <div class="w-16 h-16 rounded-full bg-orange-500/20 flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="credit-card" class="w-8 h-8 text-orange-400"></i>
                    </div>
                    <h3 class="font-ritual text-xl font-semibold mb-2">Stripe</h3>
                    <p class="text-sm text-gray-400 mb-4">Coming Soon</p>
                    <button disabled class="btn-void px-4 py-2 rounded-lg text-sm w-full opacity-50 cursor-not-allowed">
                        Not Available
                    </button>
                </div>
            </div>

            <div class="glass-panel rounded-2xl p-8 max-w-2xl mx-auto text-center">
                <i data-lucide="heart" class="w-8 h-8 text-red-500 mx-auto mb-4"></i>
                <p class="font-script text-lg text-gray-300 italic">
                    "All donations support community creation & content. Every flame counts. Every offering matters."
                </p>
            </div>
        </section>

        <!-- ADMIN SECTION -->
        <section id="section-admin" class="section-hidden">
            <div class="text-center mb-12">
                <h1 class="font-ritual text-4xl md:text-5xl font-bold mb-4 text-red-500">The Council</h1>
                <p class="font-script italic text-xl text-gray-400">Administrative sanctum. Handle with care.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 max-w-5xl mx-auto">
                <!-- Vote Management -->
                <div class="admin-panel rounded-2xl p-6">
                    <h3 class="font-ritual text-xl font-semibold mb-6 flex items-center gap-2 text-orange-400">
                        <i data-lucide="flame" class="w-5 h-5"></i>
                        Flame Control
                    </h3>
                    <div class="space-y-4">
                        <div class="flex gap-3">
                            <button onclick="startVote(12)" class="btn-sacred text-white px-4 py-3 rounded-lg text-sm flex-1">
                                Start 12h Cycle
                            </button>
                            <button onclick="startVote(24)" class="btn-sacred text-white px-4 py-3 rounded-lg text-sm flex-1">
                                Start 24h Cycle
                            </button>
                            <button onclick="startVote(48)" class="btn-sacred text-white px-4 py-3 rounded-lg text-sm flex-1">
                                Start 48h Cycle
                            </button>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="endVote()" class="danger-btn px-4 py-3 rounded-lg text-sm flex-1">
                                End Cycle Now
                            </button>
                            <button onclick="resetVotes()" class="danger-btn px-4 py-3 rounded-lg text-sm flex-1">
                                Reset All Flames
                            </button>
                        </div>
                    </div>
                </div>

                <!-- User Management -->
                <div class="admin-panel rounded-2xl p-6">
                    <h3 class="font-ritual text-xl font-semibold mb-6 flex items-center gap-2 text-orange-400">
                        <i data-lucide="users" class="w-5 h-5"></i>
                        Order Management
                    </h3>
                    <div class="space-y-4">
                        <div id="admin-users-list" class="max-h-64 overflow-y-auto space-y-2">
                            <!-- Populated by JS -->
                        </div>
                        <button onclick="loadAdminUsers()" class="btn-void w-full py-2 rounded-lg text-sm">
                            Refresh List
                        </button>
                    </div>
                </div>

                <!-- Content Management -->
                <div class="admin-panel rounded-2xl p-6 lg:col-span-2">
                    <h3 class="font-ritual text-xl font-semibold mb-6 flex items-center gap-2 text-orange-400">
                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                        Content Purge
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="clearSuggestions()" class="danger-btn px-4 py-4 rounded-lg text-sm flex items-center justify-center gap-2">
                            <i data-lucide="message-square-x" class="w-4 h-4"></i>
                            Clear All Whispers
                        </button>
                        <button onclick="clearReplies()" class="danger-btn px-4 py-4 rounded-lg text-sm flex items-center justify-center gap-2">
                            <i data-lucide="message-circle-x" class="w-4 h-4"></i>
                            Clear All Replies
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Auth Modal -->
    <div id="auth-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="toggleAuth()"></div>
        <div class="relative z-10 max-w-md mx-auto mt-20 px-4">
            <div class="glass-panel rounded-2xl p-8">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 rounded-full ember-gradient flex items-center justify-center mx-auto mb-4 ember-glow">
                        <i data-lucide="key" class="w-8 h-8 text-white"></i>
                    </div>
                    <h2 class="font-ritual text-2xl font-bold text-white">Enter the Sanctum</h2>
                    <p class="text-sm text-gray-400 mt-2">Sign in to cast thy flame</p>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-ritual tracking-wider text-gray-500 uppercase mb-2">Sacred Address</label>
                        <input type="email" id="auth-email" class="input-dark w-full p-3 rounded-lg" placeholder="devotee@sanctuary.com">
                    </div>
                    <div>
                        <label class="block text-xs font-ritual tracking-wider text-gray-500 uppercase mb-2">Secret Word</label>
                        <input type="password" id="auth-password" class="input-dark w-full p-3 rounded-lg" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    
                    <div class="flex gap-3 pt-2">
                        <button onclick="signIn()" class="btn-sacred flex-1 text-white py-3 rounded-lg font-medium">
                            Enter
                        </button>
                        <button onclick="signUp()" class="btn-void flex-1 py-3 rounded-lg font-medium">
                            Join
                        </button>
                    </div>
                </div>

                <div class="mt-6 pt-6 border-t border-white/10">
                    <button onclick="signInWithOAuth('google')" class="btn-void w-full py-3 rounded-lg flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                        </svg>
                        <span>Continue with Google</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 right-6 bg-gray-900 border border-orange-500/30 text-white px-6 py-4 rounded-xl shadow-2xl z-50 hidden transform transition-all">
        <p id="toast-message" class="font-ritual"></p>
    </div>

    <!-- Social Media Footer -->
    <footer class="relative z-10 border-t border-white/10 bg-black/20 backdrop-blur-md mt-20 py-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <div class="flex justify-center items-center gap-6 mb-6">
                <a href="https://www.youtube.com/@truufbtold" target="_blank" class="group flex items-center gap-3 px-6 py-3 rounded-full bg-white/5 hover:bg-red-600/20 border border-white/10 hover:border-red-500/50 transition-all duration-300 magnetic-btn">
                    <svg class="w-6 h-6 text-red-500" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                    <span class="font-ritual text-white group-hover:text-red-400 transition-colors">@truufbtold</span>
                </a>
                
                <a href="https://www.tiktok.com/@truufbtold" target="_blank" class="group flex items-center gap-3 px-6 py-3 rounded-full bg-white/5 hover:bg-black/40 border border-white/10 hover:border-white/30 transition-all duration-300 magnetic-btn">
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/></svg>
                    <span class="font-ritual text-white group-hover:text-gray-300 transition-colors">@truufbtold</span>
                </a>
            </div>
            <p class="font-script italic text-gray-500 text-sm">
                "Join the congregation across all realms"
            </p>
        </div>
    </footer>

    <script>
        // üöÄ AUTO-CONFIG: Fetches from Vercel Environment Variables
        let supabase = null;
        let isDemoMode = true;
        
        async function initSupabase() {
            try {
                const response = await fetch('/api/env');
                const env = await response.json();
                
                if (env.url && env.key && window.supabase && !env.demo) {
                    supabase = window.supabase.createClient(env.url, env.key);
                    isDemoMode = false;
                    console.log('üî• Connected to Supabase via Vercel');
                    return true;
                } else if (env.demo) {
                    console.log('üîß DEMO MODE: Set SUPABASE_URL and SUPABASE_ANON_KEY in Vercel env vars');
                    // Initialize demo mode
                    if (!localStorage.getItem('demoUser')) {
                        localStorage.setItem('demoUser', JSON.stringify({id: '1', email: 'admin@truthbtoldhub.com'}));
                    }
                    return false;
                }
            } catch (e) {
                console.log('üîß DEMO MODE: API not available, using localStorage');
                // Initialize demo mode as fallback
                if (!localStorage.getItem('demoUser')) {
                    localStorage.setItem('demoUser', JSON.stringify({id: '1', email: 'admin@truthbtoldhub.com'}));
                }
                return false;
            }
            return false;
        }
        
        // Demo data helpers
        function getDemoVotes() {
            return JSON.parse(localStorage.getItem('demoVotes') || '[]');
        }
        function saveDemoVotes(votes) {
            localStorage.setItem('demoVotes', JSON.stringify(votes));
        }
        function getDemoMembers() {
            return JSON.parse(localStorage.getItem('demoMembers') || '[]');
        }
        function saveDemoMembers(members) {
            localStorage.setItem('demoMembers', JSON.stringify(members));
        }
        function getDemoSuggestions() {
            return JSON.parse(localStorage.getItem('demoSuggestions') || '[]');
        }
        function saveDemoSuggestions(suggestions) {
            localStorage.setItem('demoSuggestions', JSON.stringify(suggestions));
        }
        function getDemoReplies() {
            return JSON.parse(localStorage.getItem('demoReplies') || '[]');
        }
        function saveDemoReplies(replies) {
            localStorage.setItem('demoReplies', JSON.stringify(replies));
        }

        // State
        let currentUser = null;
        
        // Initialize after Supabase check
        async function initApp() {
            await initSupabase();
            currentUser = isDemoMode ? JSON.parse(localStorage.getItem('demoUser') || 'null') : null;
            
            if (isDemoMode) {
                console.log('üß™ RUNNING IN DEMO MODE - All data stored in localStorage');
                loadDemoData();
                if (!localStorage.getItem('demoShown')) {
                    showToast('Demo Mode: Connect Supabase in Vercel env vars for real data');
                    localStorage.setItem('demoShown', 'true');
                }
            }
            
            checkSession();
            loadVotes();
            loadMembers();
            loadSuggestions();
            renderVotingGrid();
            startTimer();
            
            // Character counter for suggestions
            const suggestionInput = document.getElementById('suggestion-input');
            if (suggestionInput) {
                suggestionInput.addEventListener('input', function() {
                    document.getElementById('char-count').textContent = `${this.value.length} / 500`;
                });
            }
            
            updateAuthUI();
        }
        let isAdmin = currentUser?.email === 'admin@truthbtoldhub.com';
        let voteTimer = null;
        let currentTab = 'home';

        // Voting Options (8 Sanctuaries)
        const sanctuaries = [
            { id: 'stage', name: 'The Stage', icon: 'mic', description: 'Music, podcasts, audio content', flames: 0 },
            { id: 'circle', name: 'The Circle', icon: 'message-circle', description: 'Live chat and discussions', flames: 0 },
            { id: 'pool', name: 'The Pool', icon: 'droplets', description: 'Community fund and aid', flames: 0 },
            { id: 'gallery', name: 'The Gallery', icon: 'image', description: 'Videos, films, visual art', flames: 0 },
            { id: 'library', name: 'The Library', icon: 'book-open', description: 'Writings and references', flames: 0 },
            { id: 'temple', name: 'The Temple', icon: 'landmark', description: 'Teachings and dialogues', flames: 0 },
            { id: 'council', name: 'The Council', icon: 'handshake', description: 'Events and projects', flames: 0 },
            { id: 'archive', name: 'The Archive', icon: 'scroll', description: 'Historical records', flames: 0 }
        ];

        // Initialize GSAP
        gsap.registerPlugin(ScrollTrigger);

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            initializeEmbers();
            initGSAPAnimations();
            initMagneticButtons();
            initCursorGlow();
            initApp(); // New async init that fetches env vars first
        });

        // GSAP Animations
        function initGSAPAnimations() {
            // Hero text reveal
            gsap.from("#hero-title", {
                y: 100,
                opacity: 0,
                duration: 1.2,
                ease: "power3.out",
                delay: 0.2
            });
            
            gsap.from("#hero-subtitle", {
                y: 50,
                opacity: 0,
                duration: 1,
                ease: "power3.out",
                delay: 0.6
            });

            // Stagger cards entrance
            gsap.from(".vote-option", {
                scrollTrigger: {
                    trigger: "#voting-grid",
                    start: "top 80%",
                },
                y: 60,
                opacity: 0,
                duration: 0.8,
                stagger: 0.1,
                ease: "power3.out"
            });

            // Glass panel parallax
            gsap.utils.toArray('.glass-panel').forEach(panel => {
                gsap.from(panel, {
                    scrollTrigger: {
                        trigger: panel,
                        start: "top 85%",
                    },
                    y: 40,
                    opacity: 0,
                    duration: 0.8,
                    ease: "power2.out"
                });
            });

            // Navigation tabs stagger
            gsap.from("nav button", {
                y: -20,
                opacity: 0,
                duration: 0.6,
                stagger: 0.1,
                ease: "power2.out",
                delay: 0.4
            });

            // Header elements
            gsap.from("header > div", {
                x: -30,
                opacity: 0,
                duration: 0.8,
                ease: "power2.out",
                delay: 0.1
            });
        }

        // Magnetic Button Effect
        function initMagneticButtons() {
            const buttons = document.querySelectorAll('.magnetic-btn, .btn-sacred, .btn-void, .vote-option');
            
            buttons.forEach(btn => {
                btn.addEventListener('mousemove', (e) => {
                    const rect = btn.getBoundingClientRect();
                    const x = e.clientX - rect.left - rect.width / 2;
                    const y = e.clientY - rect.top - rect.height / 2;
                    
                    gsap.to(btn, {
                        x: x * 0.2,
                        y: y * 0.2,
                        duration: 0.3,
                        ease: "power2.out"
                    });
                });
                
                btn.addEventListener('mouseleave', () => {
                    gsap.to(btn, {
                        x: 0,
                        y: 0,
                        duration: 0.3,
                        ease: "power2.out"
                    });
                });
            });
        }

        // Cursor Glow Effect
        function initCursorGlow() {
            const cursor = document.getElementById('cursor-glow');
            let mouseX = 0, mouseY = 0;
            let cursorX = 0, cursorY = 0;
            
            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            // Smooth follow
            function animate() {
                cursorX += (mouseX - cursorX) * 0.1;
                cursorY += (mouseY - cursorY) * 0.1;
                
                cursor.style.left = cursorX + 'px';
                cursor.style.top = cursorY + 'px';
                
                requestAnimationFrame(animate);
            }
            animate();
            
            // Enhance glow on interactive elements
            const interactives = document.querySelectorAll('button, a, .vote-option');
            interactives.forEach(el => {
                el.addEventListener('mouseenter', () => {
                    gsap.to(cursor, {
                        scale: 1.5,
                        opacity: 0.8,
                        duration: 0.3
                    });
                });
                el.addEventListener('mouseleave', () => {
                    gsap.to(cursor, {
                        scale: 1,
                        opacity: 0.6,
                        duration: 0.3
                    });
                });
            });
        }

        // Text scramble effect for headers
        function textScramble(element, finalText) {
            const chars = '!<>-_\\/[]{}‚Äî=+*^?#________';
            let iteration = 0;
            const interval = setInterval(() => {
                element.innerText = finalText
                    .split('')
                    .map((letter, index) => {
                        if(index < iteration) {
                            return finalText[index];
                        }
                        return chars[Math.floor(Math.random() * chars.length)];
                    })
                    .join('');
                
                if(iteration >= finalText.length){ 
                    clearInterval(interval);
                }
                iteration += 1/3;
            }, 30);
        }

        // Demo Mode Data Helpers
        function loadDemoData() {
            // Check if we need to reset (if user clicked sign out)
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('signedOut') === 'true') {
                localStorage.removeItem('demoUser');
                window.history.replaceState({}, document.title, window.location.pathname);
            }
            
            // Initialize demo data if not exists
            if (!localStorage.getItem('demoVotes')) {
                localStorage.setItem('demoVotes', JSON.stringify([
                    { sanctuary_id: 'stage', user_id: 'demo1', created_at: new Date().toISOString() },
                    { sanctuary_id: 'pool', user_id: 'demo2', created_at: new Date().toISOString() },
                    { sanctuary_id: 'stage', user_id: 'demo3', created_at: new Date().toISOString() }
                ]));
            }
            if (!localStorage.getItem('demoMembers')) {
                localStorage.setItem('demoMembers', JSON.stringify([
                    { id: '1', email: 'admin@truthbtoldhub.com', created_at: new Date().toISOString() },
                    { id: '2', email: 'devotee@sacred.com', created_at: new Date().toISOString() },
                    { id: '3', email: 'seeker@truth.com', created_at: new Date().toISOString() }
                ]));
            }
            if (!localStorage.getItem('demoSuggestions')) {
                localStorage.setItem('demoSuggestions', JSON.stringify([
                    { 
                        id: '1', 
                        user_id: '2', 
                        content: 'Let us add a meditation section to the Temple sanctuary. A place for guided contemplations.', 
                        created_at: new Date().toISOString(),
                        likes: [],
                        profiles: { email: 'devotee@sacred.com' }
                    },
                    { 
                        id: '2', 
                        user_id: '3', 
                        content: 'The Stage needs better audio quality for spoken word performances.', 
                        created_at: new Date(Date.now() - 86400000).toISOString(),
                        likes: ['demo1'],
                        profiles: { email: 'seeker@truth.com' }
                    }
                ]));
            }
            if (!localStorage.getItem('demoReplies')) {
                localStorage.setItem('demoReplies', JSON.stringify([
                    { id: '1', suggestion_id: '1', user_id: '1', content: 'I second this motion. The Temple grows stronger with meditation.', created_at: new Date().toISOString() }
                ]));
            }
        }

        function getDemoVotes() {
            return JSON.parse(localStorage.getItem('demoVotes') || '[]');
        }
        function saveDemoVotes(votes) {
            localStorage.setItem('demoVotes', JSON.stringify(votes));
        }
        function getDemoMembers() {
            return JSON.parse(localStorage.getItem('demoMembers') || '[]');
        }
        function saveDemoMembers(members) {
            localStorage.setItem('demoMembers', JSON.stringify(members));
        }
        function getDemoSuggestions() {
            return JSON.parse(localStorage.getItem('demoSuggestions') || '[]');
        }
        function saveDemoSuggestions(suggestions) {
            localStorage.setItem('demoSuggestions', JSON.stringify(suggestions));
        }
        function getDemoReplies() {
            return JSON.parse(localStorage.getItem('demoReplies') || '[]');
        }
        function saveDemoReplies(replies) {
            localStorage.setItem('demoReplies', JSON.stringify(replies));
        }

        function initializeEmbers() {
            const container = document.getElementById('ember-container');
            for (let i = 0; i < 20; i++) {
                const ember = document.createElement('div');
                ember.className = 'floating-ember';
                ember.style.left = Math.random() * 100 + '%';
                ember.style.animationDelay = Math.random() * 15 + 's';
                ember.style.animationDuration = (10 + Math.random() * 10) + 's';
                container.appendChild(ember);
            }
        }

        // Tab Navigation
        function showTab(tab) {
            // Hide all sections
            document.querySelectorAll('section').forEach(s => {
                s.classList.remove('section-active');
                s.classList.add('section-hidden');
            });
            
            // Show selected
            document.getElementById(`section-${tab}`).classList.remove('section-hidden');
            document.getElementById(`section-${tab}`).classList.add('section-active');
            
            // Update tab styles
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('text-gray-400');
            });
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
            document.getElementById(`tab-${tab}`).classList.remove('text-gray-400');
            
            currentTab = tab;
            
            // Load data for specific tabs
            if (tab === 'members') loadMembers();
            if (tab === 'suggestions') loadSuggestions();
            if (tab === 'admin' && isAdmin) loadAdminUsers();
            
            lucide.createIcons();
        }

        // UI Update Helper
        function updateAuthUI() {
            if (currentUser) {
                document.getElementById('user-status').textContent = currentUser.email.split('@')[0];
                document.getElementById('auth-btn').classList.add('hidden');
                document.getElementById('logout-btn').classList.remove('hidden');
                document.getElementById('user-vote-status').textContent = 'Ready';
                document.getElementById('user-vote-status').classList.add('ember-text');
                
                if (isAdmin) {
                    document.getElementById('tab-admin').classList.remove('hidden');
                    document.getElementById('admin-vote-controls').classList.remove('hidden');
                }
                
                if (!isDemoMode) checkUserVote();
            } else {
                document.getElementById('user-status').textContent = 'Guest';
                document.getElementById('auth-btn').classList.remove('hidden');
                document.getElementById('logout-btn').classList.add('hidden');
                document.getElementById('user-vote-status').textContent = 'Silent';
                document.getElementById('user-vote-status').classList.remove('ember-text');
                document.getElementById('tab-admin').classList.add('hidden');
                document.getElementById('admin-vote-controls').classList.add('hidden');
            }
        }

        // Auth Functions
        async function checkSession() {
            if (isDemoMode) {
                if (currentUser) {
                    isAdmin = currentUser.email === 'admin@truthbtoldhub.com';
                    updateAuthUI();
                    if (currentTab === 'home') checkUserVote();
                }
                return;
            }
            
            if (!supabase) return;
            
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                currentUser = session.user;
                isAdmin = currentUser.email === 'admin@truthbtoldhub.com';
                updateAuthUI();
                checkUserVote();
            }
        }

        function toggleAuth() {
            const modal = document.getElementById('auth-modal');
            modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) {
                lucide.createIcons();
            }
        }

        async function signIn() {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            
            if (isDemoMode) {
                // Demo mode sign in
                const members = getDemoMembers();
                const member = members.find(m => m.email === email);
                if (member) {
                    currentUser = { id: member.id, email: member.email };
                    localStorage.setItem('demoUser', JSON.stringify(currentUser));
                    isAdmin = email === 'admin@truthbtoldhub.com';
                    updateAuthUI();
                    toggleAuth();
                    showToast('Welcome to the Sanctum (Demo Mode)');
                    loadMembers();
                    loadSuggestions();
                    renderVotingGrid();
                } else {
                    showToast('Member not found. Try admin@truthbtoldhub.com');
                }
                return;
            }
            
            const { error } = await supabase.auth.signInWithPassword({ email, password });
            if (error) {
                showToast(error.message);
            } else {
                toggleAuth();
                checkSession();
                showToast('Welcome to the Sanctum');
            }
        }

        async function signUp() {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            
            if (isDemoMode) {
                // Demo mode sign up
                const members = getDemoMembers();
                if (members.find(m => m.email === email)) {
                    showToast('Member already exists');
                    return;
                }
                const newMember = {
                    id: 'demo_' + Date.now(),
                    email: email,
                    created_at: new Date().toISOString()
                };
                members.push(newMember);
                saveDemoMembers(members);
                currentUser = { id: newMember.id, email: email };
                localStorage.setItem('demoUser', JSON.stringify(currentUser));
                updateAuthUI();
                toggleAuth();
                showToast('Welcome to the Order (Demo Mode)');
                loadMembers();
                return;
            }
            
            const { error } = await supabase.auth.signUp({ 
                email, 
                password,
                options: { emailRedirectTo: window.location.origin }
            });
            if (error) {
                showToast(error.message);
            } else {
                showToast('Check thy scrolls for confirmation');
            }
        }

        async function signInWithOAuth(provider) {
            if (isDemoMode) {
                showToast('OAuth not available in demo mode. Use email sign in.');
                return;
            }
            await supabase.auth.signInWithOAuth({
                provider,
                options: { redirectTo: window.location.origin }
            });
        }

        async function signOut() {
            if (isDemoMode) {
                currentUser = null;
                isAdmin = false;
                localStorage.removeItem('demoUser');
                // Add query param to prevent auto-relogin
                window.location.href = 'index.html?signedOut=true';
                return;
            }
            
            await supabase.auth.signOut();
            currentUser = null;
            isAdmin = false;
            location.reload();
        }

        // Voting System
        function renderVotingGrid() {
            const grid = document.getElementById('voting-grid');
            
            // Reset flames
            sanctuaries.forEach(s => s.flames = 0);
            
            // Load current votes
            let votes = [];
            if (isDemoMode) {
                votes = getDemoVotes();
            } else if (supabase) {
                // Will be loaded via loadVotes()
            }
            
            votes.forEach(vote => {
                const s = sanctuaries.find(s => s.id === vote.sanctuary_id);
                if (s) s.flames++;
            });
            
            const total = sanctuaries.reduce((sum, s) => sum + s.flames, 0);
            document.getElementById('total-flames').textContent = total;
            
            grid.innerHTML = sanctuaries.map(s => {
                const percentage = total > 0 ? ((s.flames / total) * 100).toFixed(1) : 0;
                const isSelected = currentUser && votes.some(v => 
                    v.user_id === currentUser.id && v.sanctuary_id === s.id
                );
                
                return `
                    <div class="vote-option card-lift rounded-2xl p-6 cursor-pointer ${isSelected ? 'selected' : ''}" onclick="castVote('${s.id}')" data-id="${s.id}">
                        <div class="flex items-start justify-between mb-4">
                            <div class="w-12 h-12 rounded-xl bg-gray-800 flex items-center justify-center border border-white/5 icon-container">
                                <i data-lucide="${s.icon}" class="w-6 h-6 text-orange-500"></i>
                            </div>
                            <div class="text-right">
                                <span class="font-ritual text-2xl font-bold ember-text flame-counter">${s.flames}</span>
                                <p class="text-xs text-gray-500">flames</p>
                            </div>
                        </div>
                        <h3 class="font-ritual text-lg font-semibold text-white mb-2 sanctuary-name">${s.name}</h3>
                        <p class="text-sm text-gray-400 mb-4">${s.description}</p>
                        <div class="h-2 bg-gray-800 rounded-full overflow-hidden progress-container">
                            <div class="progress-fill h-full rounded-full" style="width: ${percentage}%"></div>
                        </div>
                        <p class="text-xs text-gray-500 mt-2 text-right percentage-text">${percentage}%</p>
                    </div>
                `;
            }).join('');
            
            // Animate cards on render
            gsap.from(".vote-option", {
                scale: 0.9,
                opacity: 0,
                duration: 0.4,
                stagger: 0.05,
                ease: "back.out(1.7)"
            });
            
            updateVoteTable();
            lucide.createIcons();
        }

        async function castVote(sanctuaryId) {
            if (!currentUser) {
                toggleAuth();
                showToast('Sign in to cast thy flame');
                return;
            }
            
            if (isDemoMode) {
                const votes = getDemoVotes();
                
                // Check if already voted in this cycle (24 hours)
                const existing = votes.filter(v => 
                    v.user_id === currentUser.id && 
                    new Date(v.created_at) > new Date(Date.now() - 24 * 60 * 60 * 1000)
                );
                
                if (existing.length > 0) {
                    showToast('Thou hast already cast thy flame this cycle (24h limit)');
                    return;
                }
                
                // Record vote
                votes.push({
                    user_id: currentUser.id,
                    sanctuary_id: sanctuaryId,
                    created_at: new Date().toISOString()
                });
                saveDemoVotes(votes);
                
                // Update UI
                renderVotingGrid();
                document.getElementById('user-vote-status').textContent = 'Cast';
                showToast('Thy flame burns bright (Demo Mode)');
                return;
            }
            
            if (!supabase) {
                showToast('Supabase not connected');
                return;
            }
            
            // Check if already voted in this cycle
            const { data: existing } = await supabase
                .from('votes')
                .select('*')
                .eq('user_id', currentUser.id)
                .gte('created_at', new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString());
            
            if (existing && existing.length > 0) {
                showToast('Thou hast already cast thy flame this cycle');
                return;
            }
            
            // Record vote
            const { error } = await supabase.from('votes').insert({
                user_id: currentUser.id,
                sanctuary_id: sanctuaryId,
                created_at: new Date().toISOString()
            });
            
            if (error) {
                showToast('Error recording flame');
                console.error(error);
                return;
            }
            
            // Update local count
            const sanctuary = sanctuaries.find(s => s.id === sanctuaryId);
            if (sanctuary) sanctuary.flames++;
            
            // Update UI
            renderVotingGrid();
            document.getElementById('user-vote-status').textContent = 'Cast';
            
            showToast('Thy flame burns bright');
        }

        async function checkUserVote() {
            if (!currentUser) return;
            
            const { data: votes } = await supabase
                .from('votes')
                .select('*')
                .eq('user_id', currentUser.id)
                .gte('created_at', new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString());
            
            if (votes && votes.length > 0) {
                document.getElementById('user-vote-status').textContent = 'Cast';
                document.querySelector(`.vote-option[data-id="${votes[0].sanctuary_id}"]`)?.classList.add('selected');
            }
        }

        function updateVoteTable() {
            const tbody = document.getElementById('vote-table-body');
            const total = sanctuaries.reduce((sum, s) => sum + s.flames, 0);
            const sorted = [...sanctuaries].sort((a, b) => b.flames - a.flames);
            
            tbody.innerHTML = sorted.map(s => {
                const percentage = total > 0 ? ((s.flames / total) * 100).toFixed(1) : 0;
                const isLeading = s.flames === sorted[0].flames && s.flames > 0;
                return `
                    <tr class="border-b border-white/5 hover:bg-white/5 transition-colors">
                        <td class="py-4 font-ritual">${s.name}</td>
                        <td class="py-4 font-bold ember-text">${s.flames}</td>
                        <td class="py-4 text-gray-400">${percentage}%</td>
                        <td class="py-4">
                            ${isLeading ? '<span class="text-xs bg-orange-500/20 text-orange-400 px-2 py-1 rounded">Leading</span>' : '<span class="text-xs text-gray-500">-</span>'}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function loadVotes() {
            const { data } = await supabase.from('votes').select('*');
            if (data) {
                data.forEach(vote => {
                    const s = sanctuaries.find(s => s.id === vote.sanctuary_id);
                    if (s) s.flames++;
                });
                renderVotingGrid();
                document.getElementById('total-flames').textContent = data.length;
            }
        }

        // Admin Functions
        async function startVote(hours) {
            if (!isAdmin) {
                showToast('Only the Council may start cycles');
                return;
            }
            if (!confirm(`Start ${hours} hour voting cycle?`)) return;
            
            if (isDemoMode) {
                localStorage.setItem('demoVoteEnd', new Date(Date.now() + hours * 60 * 60 * 1000).toISOString());
                showToast(`${hours} hour cycle begun (Demo)`);
                return;
            }
            
            if (!supabase) return;
            
            const { error } = await supabase.from('vote_cycles').insert({
                started_at: new Date().toISOString(),
                ends_at: new Date(Date.now() + hours * 60 * 60 * 1000).toISOString(),
                duration: hours
            });
            
            if (error) {
                showToast('Error starting cycle');
                console.error(error);
            } else {
                showToast(`${hours} hour cycle begun`);
            }
        }

        async function endVote() {
            if (!isAdmin) {
                showToast('Only the Council may end cycles');
                return;
            }
            if (!confirm('End current voting cycle?')) return;
            
            if (isDemoMode) {
                localStorage.removeItem('demoVoteEnd');
                showToast('Cycle ended (Demo)');
                return;
            }
            
            showToast('Cycle ended');
        }

        async function resetVotes() {
            if (!isAdmin) {
                showToast('Only the Council may reset flames');
                return;
            }
            if (!confirm('Reset ALL flames? This cannot be undone.')) return;
            if (!confirm('Truly? All voting history will be erased?')) return;
            
            if (isDemoMode) {
                localStorage.setItem('demoVotes', '[]');
                localStorage.removeItem('demoVoteEnd');
                sanctuaries.forEach(s => s.flames = 0);
                renderVotingGrid();
                document.getElementById('total-flames').textContent = '0';
                showToast('All flames extinguished (Demo)');
                return;
            }
            
            if (!supabase) return;
            
            const { error } = await supabase.from('votes').delete().neq('id', 'placeholder');
            if (error) {
                showToast('Error resetting votes');
                return;
            }
            
            sanctuaries.forEach(s => s.flames = 0);
            renderVotingGrid();
            document.getElementById('total-flames').textContent = '0';
            showToast('All flames extinguished');
        }

        // Timer
        function startTimer() {
            const endTime = new Date(Date.now() + 24 * 60 * 60 * 1000); // Default 24h
            
            function update() {
                const now = new Date();
                const diff = endTime - now;
                
                if (diff <= 0) {
                    document.getElementById('countdown').textContent = '00:00:00';
                    return;
                }
                
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                document.getElementById('countdown').textContent = 
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }
            
            update();
            voteTimer = setInterval(update, 1000);
        }

        // Members
        async function loadMembers() {
            let data = [];
            
            if (isDemoMode) {
                data = getDemoMembers();
            } else if (supabase) {
                const { data: supabaseData, error } = await supabase.from('profiles').select('*');
                if (error) {
                    console.error('Error loading members:', error);
                    return;
                }
                data = supabaseData || [];
            } else {
                return;
            }
            
            document.getElementById('member-count').textContent = data.length;
            
            const grid = document.getElementById('members-grid');
            grid.innerHTML = data.map((member, i) => {
                const tier = i < 3 ? 'keeper' : i < 10 ? 'flame' : 'ember';
                const colors = ['from-orange-400 to-red-500', 'from-blue-400 to-purple-500', 'from-green-400 to-teal-500'];
                const color = colors[i % 3];
                
                return `
                    <div class="glass-card rounded-xl p-4 flex items-center gap-4" data-tier="${tier}">
                        <div class="w-12 h-12 rounded-full bg-gradient-to-br ${color} flex items-center justify-center font-bold text-white">
                            ${member.email?.charAt(0).toUpperCase() || 'M'}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="font-ritual font-semibold text-white truncate">${member.email?.split('@')[0] || 'Member'}</h4>
                            <p class="text-xs text-gray-500 uppercase tracking-wider">${tier}</p>
                        </div>
                        ${isAdmin ? `
                            <button onclick="deleteUser('${member.id}')" class="text-red-500 hover:text-red-400 p-1">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            lucide.createIcons();
        }

        function filterMembers() {
            const filter = document.getElementById('member-filter').value;
            document.querySelectorAll('#members-grid > div').forEach(el => {
                if (filter === 'all' || el.dataset.tier === filter) {
                    el.style.display = 'flex';
                } else {
                    el.style.display = 'none';
                }
            });
        }

        // Suggestions
        async function loadSuggestions() {
            let data = [];
            
            if (isDemoMode) {
                const suggestions = getDemoSuggestions();
                const replies = getDemoReplies();
                const members = getDemoMembers();
                
                data = suggestions.map(s => ({
                    ...s,
                    profiles: members.find(m => m.id === s.user_id) || { email: 'unknown@sanctum.com' },
                    replies: replies.filter(r => r.suggestion_id === s.id)
                }));
            } else if (supabase) {
                const { data: supabaseData, error } = await supabase
                    .from('suggestions')
                    .select('*, profiles(email), replies(*)')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('Error loading suggestions:', error);
                    return;
                }
                data = supabaseData || [];
            } else {
                return;
            }
            
            if (!data || data.length === 0) {
                document.getElementById('suggestions-list').innerHTML = '<p class="text-gray-500 text-center py-8">No whispers yet... Be the first to speak.</p>';
                return;
            }
            
            const container = document.getElementById('suggestions-list');
            container.innerHTML = data.map(s => `
                <div class="suggestion-card rounded-xl p-6" data-id="${s.id}">
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-orange-400 to-red-500 flex items-center justify-center font-bold text-white flex-shrink-0">
                            ${s.profiles?.email?.charAt(0).toUpperCase() || 'A'}
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-ritual font-semibold text-white">${s.profiles?.email?.split('@')[0] || 'Anonymous'}</span>
                                <span class="text-xs text-gray-500">${new Date(s.created_at).toLocaleDateString()}</span>
                            </div>
                            <p class="text-gray-300 mb-4">${s.content}</p>
                            
                            <div class="flex items-center gap-4 mb-4">
                                <button onclick="likeSuggestion('${s.id}')" class="like-btn flex items-center gap-1 text-gray-400 ${s.likes?.includes(currentUser?.id) ? 'liked' : ''}">
                                    <i data-lucide="flame" class="w-4 h-4"></i>
                                    <span class="text-sm">${s.likes?.length || 0}</span>
                                </button>
                                <button onclick="toggleReplies('${s.id}')" class="flex items-center gap-1 text-gray-400 hover:text-orange-400 transition-colors">
                                    <i data-lucide="message-square" class="w-4 h-4"></i>
                                    <span class="text-sm">${s.replies?.length || 0} replies</span>
                                </button>
                                ${isAdmin ? `
                                    <button onclick="deleteSuggestion('${s.id}')" class="ml-auto text-red-500 hover:text-red-400">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                ` : ''}
                            </div>
                            
                            <!-- Replies Section -->
                            <div id="replies-${s.id}" class="hidden space-y-3 mt-4">
                                ${s.replies?.map(r => `
                                    <div class="reply-box rounded-lg p-3">
                                        <p class="text-sm text-gray-400">${r.content}</p>
                                    </div>
                                `).join('') || ''}
                                ${currentUser ? `
                                    <div class="flex gap-2">
                                        <input type="text" id="reply-input-${s.id}" maxlength="300" 
                                            class="input-dark flex-1 p-2 rounded-lg text-sm" 
                                            placeholder="Add reply... (300 chars)">
                                        <button onclick="postReply('${s.id}')" class="btn-sacred px-4 py-2 rounded-lg text-sm text-white">
                                            Reply
                                        </button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        async function postSuggestion() {
            if (!currentUser) {
                toggleAuth();
                return;
            }
            
            const content = document.getElementById('suggestion-input').value.trim();
            if (!content) return;
            
            if (isDemoMode) {
                const suggestions = getDemoSuggestions();
                const newSuggestion = {
                    id: 'sugg_' + Date.now(),
                    user_id: currentUser.id,
                    content: content,
                    created_at: new Date().toISOString(),
                    likes: [],
                    profiles: { email: currentUser.email }
                };
                suggestions.unshift(newSuggestion);
                saveDemoSuggestions(suggestions);
                
                document.getElementById('suggestion-input').value = '';
                document.getElementById('char-count').textContent = '0 / 500';
                loadSuggestions();
                showToast('Thy whisper has been heard (Demo)');
                return;
            }
            
            if (!supabase) {
                showToast('Supabase not connected');
                return;
            }
            
            const { error } = await supabase.from('suggestions').insert({
                user_id: currentUser.id,
                content: content,
                created_at: new Date().toISOString(),
                likes: []
            });
            
            if (error) {
                showToast('Error posting whisper');
                console.error(error);
                return;
            }
            
            document.getElementById('suggestion-input').value = '';
            document.getElementById('char-count').textContent = '0 / 500';
            loadSuggestions();
            showToast('Thy whisper has been heard');
        }

        async function likeSuggestion(id) {
            if (!currentUser) {
                toggleAuth();
                return;
            }
            
            if (isDemoMode) {
                const suggestions = getDemoSuggestions();
                const suggestion = suggestions.find(s => s.id === id);
                if (suggestion) {
                    if (!suggestion.likes) suggestion.likes = [];
                    if (suggestion.likes.includes(currentUser.id)) {
                        suggestion.likes = suggestion.likes.filter(uid => uid !== currentUser.id);
                    } else {
                        suggestion.likes.push(currentUser.id);
                    }
                    saveDemoSuggestions(suggestions);
                    loadSuggestions();
                }
                return;
            }
            
            if (!supabase) return;
            
            const { data } = await supabase.from('suggestions').select('likes').eq('id', id).single();
            let likes = data?.likes || [];
            
            if (likes.includes(currentUser.id)) {
                likes = likes.filter(uid => uid !== currentUser.id);
            } else {
                likes.push(currentUser.id);
            }
            
            await supabase.from('suggestions').update({ likes }).eq('id', id);
            loadSuggestions();
        }

        function toggleReplies(id) {
            const el = document.getElementById(`replies-${id}`);
            el.classList.toggle('hidden');
        }

        async function postReply(suggestionId) {
            if (!currentUser) {
                toggleAuth();
                return;
            }
            
            const content = document.getElementById(`reply-input-${suggestionId}`).value.trim();
            if (!content) return;
            
            if (isDemoMode) {
                const replies = getDemoReplies();
                replies.push({
                    id: 'reply_' + Date.now(),
                    suggestion_id: suggestionId,
                    user_id: currentUser.id,
                    content: content,
                    created_at: new Date().toISOString()
                });
                saveDemoReplies(replies);
                loadSuggestions();
                return;
            }
            
            if (!supabase) return;
            
            const { error } = await supabase.from('replies').insert({
                suggestion_id: suggestionId,
                user_id: currentUser.id,
                content: content,
                created_at: new Date().toISOString()
            });
            
            if (error) {
                showToast('Error posting reply');
                console.error(error);
                return;
            }
            
            loadSuggestions();
        }

        async function deleteSuggestion(id) {
            if (!isAdmin) {
                showToast('Only the Council may remove whispers');
                return;
            }
            if (!confirm('Remove this whisper?')) return;
            
            if (isDemoMode) {
                let suggestions = getDemoSuggestions();
                suggestions = suggestions.filter(s => s.id !== id);
                saveDemoSuggestions(suggestions);
                
                let replies = getDemoReplies();
                replies = replies.filter(r => r.suggestion_id !== id);
                saveDemoReplies(replies);
                
                loadSuggestions();
                showToast('Whisper removed (Demo)');
                return;
            }
            
            if (!supabase) return;
            
            await supabase.from('suggestions').delete().eq('id', id);
            await supabase.from('replies').delete().eq('suggestion_id', id);
            loadSuggestions();
            showToast('Whisper removed');
        }

        async function clearSuggestions() {
            if (!isAdmin) {
                showToast('Only the Council may clear whispers');
                return;
            }
            if (!confirm('Clear ALL whispers?')) return;
            if (!confirm('This will delete all suggestions and replies forever.')) return;
            
            if (isDemoMode) {
                localStorage.setItem('demoSuggestions', '[]');
                localStorage.setItem('demoReplies', '[]');
                loadSuggestions();
                showToast('All whispers silenced (Demo)');
                return;
            }
            
            if (!supabase) return;
            
            await supabase.from('replies').delete().neq('id', 'placeholder');
            await supabase.from('suggestions').delete().neq('id', 'placeholder');
            loadSuggestions();
            showToast('All whispers silenced');
        }

        async function clearReplies() {
            if (!isAdmin) {
                showToast('Only the Council may clear replies');
                return;
            }
            if (!confirm('Clear ALL replies?')) return;
            
            if (isDemoMode) {
                localStorage.setItem('demoReplies', '[]');
                loadSuggestions();
                showToast('All replies cleared (Demo)');
                return;
            }
            
            if (!supabase) return;
            
            await supabase.from('replies').delete().neq('id', 'placeholder');
            loadSuggestions();
            showToast('All replies cleared');
        }

        // Admin User Management
        async function loadAdminUsers() {
            let data = [];
            
            if (isDemoMode) {
                data = getDemoMembers();
            } else if (supabase) {
                const { data: supabaseData } = await supabase.from('profiles').select('*');
                data = supabaseData || [];
            }
            
            const list = document.getElementById('admin-users-list');
            
            list.innerHTML = data?.map(u => `
                <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                    <span class="text-sm truncate">${u.email}</span>
                    <button onclick="deleteUser('${u.id}')" class="text-red-500 hover:text-red-400 text-xs px-2 py-1 border border-red-500/30 rounded">
                        Exile
                    </button>
                </div>
            `).join('') || '<p class="text-gray-500 text-sm">No members found</p>';
        }

        async function deleteUser(userId) {
            if (!isAdmin) {
                showToast('Only the Council may exile members');
                return;
            }
            if (!confirm('Exile this member from the Order?')) return;
            
            if (isDemoMode) {
                let members = getDemoMembers();
                members = members.filter(m => m.id !== userId);
                saveDemoMembers(members);
                loadMembers();
                loadAdminUsers();
                showToast('Member exiled (Demo)');
                return;
            }
            
            if (!supabase) return;
            
            // Note: Actual user deletion requires admin privileges in Supabase
            await supabase.from('profiles').delete().eq('id', userId);
            loadMembers();
            loadAdminUsers();
            showToast('Member exiled');
        }

        // Utilities
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text);
            showToast('Copied to thy scrolls');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').textContent = message;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // Auth State Listener (only if Supabase is connected)
        if (!isDemoMode && supabase) {
            supabase.auth.onAuthStateChange((event, session) => {
                if (event === 'SIGNED_IN') {
                    checkSession();
                } else if (event === 'SIGNED_OUT') {
                    location.reload();
                }
            });
        }
        
        // Handle OAuth redirect
        if (!isDemoMode && window.location.hash.includes('access_token')) {
            checkSession();
        }
    </script>
</body>
</html>